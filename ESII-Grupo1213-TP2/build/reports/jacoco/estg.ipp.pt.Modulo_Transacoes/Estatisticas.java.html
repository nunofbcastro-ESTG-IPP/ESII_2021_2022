<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Estatisticas.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ESII-Grupo1213-TP2</a> &gt; <a href="index.source.html" class="el_package">estg.ipp.pt.Modulo_Transacoes</a> &gt; <span class="el_source">Estatisticas.java</span></div><h1>Estatisticas.java</h1><pre class="source lang-java linenums">package estg.ipp.pt.Modulo_Transacoes;

import estg.ipp.pt.Interfaces.Encomenda;
import estg.ipp.pt.Utils.Utils;

import com.orgcom.District;
import com.orgcom.TransactionLine;

import static java.time.temporal.ChronoUnit.DAYS;

import java.time.LocalDate;
import java.util.Iterator;
import java.util.List;

public final class Estatisticas {

    /**
     * Construtor utilizado para privar a instanciaÃ§Ã£o desta classe
     */
<span class="nc" id="L20">    private Estatisticas() {</span>
<span class="nc" id="L21">        throw new UnsupportedOperationException();</span>
    }

    /**
     * Pesquisa as encomendas existentes no iterador e calcula o nÃºmero
     * mÃ©dio de produtos por transaÃ§Ã£o
     * 
     * @param encomendas Iterador de encomendas onde serÃ¡ efetuada a pesquisa
     * @return NÃºmero mÃ©dio de produtos por transaÃ§Ã£o
     */
    public static double getNumMedioProdutosPorTransacao(final Iterator&lt;Encomenda&gt; encomendas) {
<span class="fc bfc" id="L32" title="All 2 branches covered.">        if (encomendas == null) {</span>
<span class="fc" id="L33">            throw new IllegalArgumentException(&quot;Iterator&lt;Encomenda&gt; encomendas cannot be null.&quot;);</span>
        }

<span class="fc" id="L36">        int numEncomendas = 0;</span>
<span class="fc" id="L37">        int soma = 0;</span>
        Encomenda encomenda;
<span class="fc bfc" id="L39" title="All 2 branches covered.">        while (encomendas.hasNext()) {</span>
<span class="fc" id="L40">            encomenda = encomendas.next();</span>
<span class="fc bfc" id="L41" title="All 2 branches covered.">            for (final TransactionLine transactionLine : encomenda.getTransactionEnvio()) {</span>
<span class="fc" id="L42">                soma += transactionLine.getQuantity();</span>
<span class="fc" id="L43">            }</span>
<span class="fc" id="L44">            numEncomendas += 1;</span>
        }

<span class="fc bfc" id="L47" title="All 2 branches covered.">        if (numEncomendas == 0) {</span>
<span class="fc" id="L48">            return 0;</span>
        }
<span class="fc" id="L50">        return Utils.TwoCasesDecimals((double) soma / numEncomendas);</span>
    }

    /**
     * Pesquisa as encomendas existentes no iterador e calcula o nÃºmero
     * mÃ©dio de encomendas por dia
     * 
     * @param encomendas Iterador de encomendas onde serÃ¡ efetuada a pesquisa
     * @return NÃºmero mÃ©dio de encomendas por dia
     */
    public static double getNumMedioEncomendasPorDia(final Iterator&lt;Encomenda&gt; encomendas) {
<span class="fc bfc" id="L61" title="All 2 branches covered.">        if (encomendas == null) {</span>
<span class="fc" id="L62">            throw new IllegalArgumentException(&quot;Iterator&lt;Encomenda&gt; encomendas cannot be null.&quot;);</span>
        }

<span class="fc" id="L65">        final List&lt;Encomenda&gt; encomendasArray = Utils.iteratorToArray(encomendas);</span>

<span class="fc" id="L67">        final LocalDate oldestDate = findOldestDate(encomendasArray.iterator());</span>

<span class="fc bfc" id="L69" title="All 2 branches covered.">        if (oldestDate == null) {</span>
<span class="fc" id="L70">            return 0;</span>
        }

<span class="fc" id="L73">        final long dias = DAYS.between(oldestDate, LocalDate.now()) + 1;</span>

<span class="fc" id="L75">        return Utils.TwoCasesDecimals((double) encomendasArray.size() / dias);</span>
    }

    /**
     * MÃ©todo responsavel por encontrar a data da encomenda mais antiga
     *
     * @param encomendas Iterador de encomendas onde serÃ¡ efetuada a pesquisa
     * @return A data mais antiga
     */
    private static LocalDate findOldestDate(final Iterator&lt;Encomenda&gt; encomendas) {
<span class="fc" id="L85">        LocalDate oldestDate = null;</span>
        Encomenda encomenda;
<span class="fc bfc" id="L87" title="All 2 branches covered.">        if (encomendas.hasNext()) {</span>
<span class="fc" id="L88">            oldestDate = encomendas.next().getData();</span>
        }
<span class="pc bpc" id="L90" title="1 of 2 branches missed.">        while (encomendas.hasNext()) {</span>
<span class="nc" id="L91">            encomenda = encomendas.next();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            if (encomenda.getData().isBefore(oldestDate)) {</span>
<span class="nc" id="L93">                oldestDate = encomenda.getData();</span>
            }
        }

<span class="fc" id="L97">        return oldestDate;</span>
    }

    /**
     * Pesquisa as encomendas existentes no iterador e calcula o valor
     * mÃ©dio de transaÃ§Ãµes
     * 
     * @param encomendas Iterador de encomendas onde serÃ¡ efetuada a pesquisa
     * @return Valor mÃ©dio de transaÃ§Ãµes
     */
    public static double getValorMedioTransacoes(final Iterator&lt;Encomenda&gt; encomendas) {
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (encomendas == null) {</span>
<span class="fc" id="L109">            throw new IllegalArgumentException(&quot;Iterator&lt;Encomenda&gt; encomendas cannot be null.&quot;);</span>
        }

<span class="fc" id="L112">        int valorTrasacoes = 0;</span>
<span class="fc" id="L113">        int numEncomendas = 0;</span>

<span class="fc bfc" id="L115" title="All 2 branches covered.">        while (encomendas.hasNext()) {</span>
<span class="fc" id="L116">            final Encomenda encomenda = encomendas.next();</span>
<span class="fc bfc" id="L117" title="All 2 branches covered.">            for (final TransactionLine transactionLine : encomenda.getTransactionEnvio()) {</span>
<span class="fc" id="L118">                valorTrasacoes += transactionLine.getTotalPrice();</span>
<span class="fc" id="L119">            }</span>
<span class="fc" id="L120">            numEncomendas += 1;</span>
<span class="fc" id="L121">        }</span>

<span class="fc" id="L123">        return Utils.TwoCasesDecimals((double) valorTrasacoes / numEncomendas);</span>
    }

    /**
     * Pesquisa as encomendas existentes no iterador que se encontrem
     * no perÃ­odo de tempo indicado e calcula o total de custos de envio
     * desse perÃ­odo de tempo
     * 
     * @param encomendas Iterador de encomendas onde serÃ¡ efetuada a pesquisa
     * @param dataInicio Data de inÃ­cio do perÃ­odo de tempo utilizado na pesquisa
     * @param dataFim    Data de fim do perÃ­odo de tempo utilizado na pesquisa
     * @return Total de custos de envio no perÃ­odo de tempo indicado
     */
    public static double getTotalCustosEnvio(final Iterator&lt;Encomenda&gt; encomendas, final LocalDate dataInicio,
            final LocalDate dataFim) {
<span class="fc bfc" id="L138" title="All 6 branches covered.">        if (encomendas == null || dataInicio == null || dataFim == null) {</span>
<span class="fc" id="L139">            throw new IllegalArgumentException(&quot;The attributes cannot be null.&quot;);</span>
        }

<span class="fc bfc" id="L142" title="All 2 branches covered.">        if (dataInicio.isAfter(dataFim)) {</span>
<span class="fc" id="L143">            throw new IllegalArgumentException(&quot;The start date cannot be higher than the end date.&quot;);</span>
        }

<span class="fc" id="L146">        double totalCustoEnvio = 0;</span>

<span class="fc bfc" id="L148" title="All 2 branches covered.">        while (encomendas.hasNext()) {</span>
<span class="fc" id="L149">            final Encomenda encomenda = encomendas.next();</span>

<span class="fc bfc" id="L151" title="All 4 branches covered.">            if (!encomenda.getData().isBefore(dataInicio) &amp;&amp; !encomenda.getData().isAfter(dataFim)) {</span>
<span class="fc" id="L152">                totalCustoEnvio += encomenda.getCustoEnvio();</span>
            }
<span class="fc" id="L154">        }</span>

<span class="fc" id="L156">        return Utils.TwoCasesDecimals((double) totalCustoEnvio);</span>
    }

    /**
     * Pesquisa as encomendas existentes no iterador e calcula o valor
     * mÃ©dio de vendas e de compras por distrito
     * 
     * @param encomendas Iterador de encomendas onde serÃ¡ efetuada a pesquisa
     * @return Matriz com 18 linhas e 2 colunas. Cada linha representa nÃºmero de
     *         cada distrito, a coluna 1 guarda o valor mÃ©dio de vendas e a coluna 2
     *         guarda o valor mÃ©dio de compras
     */
    public static double[][] getValorMedioVendasComprasPorDistrito(final Iterator&lt;Encomenda&gt; encomendas) {
<span class="fc" id="L169">        double[][] valoresVendasCompras = new double[District.values().length][2];</span>
<span class="fc" id="L170">        double valorVendas = 0;</span>
<span class="fc" id="L171">        int nrVendas = 0;</span>
<span class="fc" id="L172">        double valorCompras = 0;</span>
<span class="fc" id="L173">        int nrCompras = 0;</span>

<span class="fc bfc" id="L175" title="All 2 branches covered.">        if (encomendas == null){</span>
<span class="fc" id="L176">            throw new IllegalArgumentException(&quot;The attributes cannot be null.&quot;);</span>
        }

<span class="fc" id="L179">        List&lt;Encomenda&gt; encomendasList = Utils.iteratorToArray(encomendas);</span>


<span class="fc bfc" id="L182" title="All 2 branches covered.">        for (int i = 0; i &lt; District.values().length; i++) {</span>
<span class="fc" id="L183">            final District distrito = District.values()[i];</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">            for (int j = 0; j &lt; encomendasList.size(); j++) {</span>
<span class="fc" id="L185">                final Encomenda encomenda = encomendasList.get(j);</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">                if (encomenda.getTransactionEnvio().getSender().getDistrict().equals(distrito.toString())) {</span>
<span class="fc" id="L187">                    valorVendas += encomenda.getPrecoTotal();</span>
<span class="fc" id="L188">                    nrVendas += 1;</span>
                }
<span class="fc bfc" id="L190" title="All 2 branches covered.">                if (encomenda.getTransactionEnvio().getReceiver().getDistrict().equals(distrito.toString())) {</span>
<span class="fc" id="L191">                    valorCompras += encomenda.getPrecoTotal();</span>
<span class="fc" id="L192">                    nrCompras += 1;</span>
                }
            }

<span class="fc bfc" id="L196" title="All 2 branches covered.">            if (valorVendas != 0) {</span>
<span class="fc" id="L197">                valoresVendasCompras[i][0] = Utils.TwoCasesDecimals((Double) (valorVendas / nrVendas));</span>
            } else {
<span class="fc" id="L199">                valoresVendasCompras[i][0] = 0;</span>
            }

<span class="fc bfc" id="L202" title="All 2 branches covered.">            if (valorCompras != 0) {</span>
<span class="fc" id="L203">                valoresVendasCompras[i][1] = Utils.TwoCasesDecimals((Double) (valorCompras / nrCompras));</span>
            } else {
<span class="fc" id="L205">                valoresVendasCompras[i][1] = 0;</span>
            }

<span class="fc" id="L208">            valorVendas = 0;</span>
<span class="fc" id="L209">            valorCompras = 0;</span>
<span class="fc" id="L210">            nrVendas = 0;</span>
<span class="fc" id="L211">            nrCompras = 0;</span>
        }

<span class="fc" id="L214">        return valoresVendasCompras;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>